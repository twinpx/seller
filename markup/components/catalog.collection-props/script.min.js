!function(a){"use strict";a(function(){function b(){window.matchMedia("( min-width: 768px )").matches?a(".b-catalog-element").each(function(){var b=a(this),c=b.find(".b-catalog-element__title");String(c.text()).length>40&&c.text(a.trim(String(c.text()).substring(0,39))+"...")}):a(".b-catalog-element").each(function(){var b=a(this),c=b.find(".b-catalog-element__title");String(c.text()).length>107&&c.text(a.trim(String(c.attr("title")).substring(0,107))+"...")})}-1!==String(window.location.search).search("sort=")&&setTimeout(function(){a.scrollTo(a(".bj-sorting:eq(0)").offset().top-30,500)},1500),-1!==String(window.location.search).search("PAGEN_2=")&&setTimeout(function(){a.scrollTo(a(".b-catalog-collection:eq(0)").offset().top-30,500)},1500),b(),a("#subscribeModal").on("show.bs.modal",function(b){var c=a(b.relatedTarget);a.ajax({url:c.data("ajax-url"),type:"GET",dataType:"html",data:"id="+c.closest(".b-catalog-element").attr("data-id"),success:function(b){b&&(a("#subscribeModal form").remove(),a("#subscribeModal .modal-header").after(b))},error:function(a,b,c){console.log(a),console.log(b),console.log(c)}})}),a("#subscribeModal").delegate("form","submit",function(b){b.preventDefault();var c=a(this),d=a("#subscribeModal .modal-body");a.ajax({url:c.attr("action"),type:c.attr("method"),dataType:"json",data:c.serialize(),success:function(b){b&&b.MESSAGE&&(d.height(d.height()),d.empty().append('<p class="text-center">'+b.MESSAGE+"</p>"),d.height(d.find("p").height()),a("#subscribeModal .modal-footer .btn").hide(),a("#subscribeModal .modal-footer .i-gray").show())},error:function(a,b,c){console.log(a),console.log(b),console.log(c)}})}),a(".b-catalog-element__button .btn").click(function(b){b.preventDefault(),a(".b-catalog-element__button .btn").trigger("add.ecommerce");var c=a(this);if(c.hasClass("i-gray"))return void(window.location=c.attr("href"));a.ajax({url:c.data("ajax-url"),type:"GET",dataType:"json",data:"id="+c.closest(".b-catalog-element").attr("data-id"),success:function(b){b&&"Y"===b.STATUS&&(a("#bx_cart_num").text(b.cart),a("#buyCatalogElementPopup").addClass("i-show"),setTimeout(function(){a("#buyCatalogElementPopup").addClass("i-animate")},100),c.addClass("i-gray").find("span").toggleClass("i-show"))},error:function(){}})}),a("#buyCatalogElementPopupOpaco, .b-catalog-element-popup__close").click(function(b){b.preventDefault(),a("#buyCatalogElementPopup").removeClass("i-animate"),setTimeout(function(){a("#buyCatalogElementPopup").removeClass("i-show")},500)}),a(".b-catalog-element").each(function(){function b(a,b,c){if(-1!==a.search("colors")){if(-1!==b.search(c))return!0}else if(-1!==a.search("sizes")&&b+""==c+"")return!0;return!1}function c(){var b={};v.forEach(function(c){var d,e=[];k.each(function(){var b=!0,d=a(this);e.forEach(function(a){if(!d.data(c.type+"-"+c.code)||a===d.data(c.type+"-"+c.code))return void(b=!1)}),b&&d.data(c.type+"-"+c.code)&&e.push(d.data(c.type+"-"+c.code))}),e.length&&(d=a('<div class="b-catalog-element__'+c.code+'" data-prop="'+c.code+'"></div>'),c.name&&d.append("<h6>"+c.name+"</h6>"),"color"===c.type?e.forEach(function(b){var c;c=a('<span class="b-catalog-element__colors-item" style="background-image: url( \''+b+"' )\"><span></span></span>");var e=document.createElement("img");e.setAttribute("src",b),e.addEventListener("load",function(){new Vibrant(e).isWhiteImage&&c.addClass("i-white")}),d.append(c)}):"list"===c.type&&e.forEach(function(b){var c;c=a('<span class="b-catalog-element__sizes-item"><span>'+b+"</span></span>"),d.append(c)}),b[c.code]=d)});for(var c in b)h.append("<hr>").append(b[c])}function d(){if(1===k.length)return void f(k);k.each(function(){var b=a(this),c={};v.forEach(function(a){var d=[];v.forEach(function(c){c.code!==a.code&&d.push(b.data(c.type+"-"+c.code))}),c[d.join(",")]=[a.type,a.code,a.name,b.data(a.type+"-"+a.code)]}),w[b.data("id")]=c}),f(l),e()}function e(){var b,c={},d=[],e="";v.forEach(function(f){d=[],v.forEach(function(a){a.code!==f.code&&d.push(l.data(a.type+"-"+a.code))}),e=f.code,c[e]=[],b=d.join(",");for(var h in w)w[h][b]&&c[e].push(w[h][b][3]);"color"===f.type?g.find(".b-catalog-element__"+e+" .b-catalog-element__colors-item").each(function(){for(var b=!1,d=0;d<c[e].length&&(-1!==a(this).css("backgroundImage").search(c[e][d])&&(b=!0),!b);d++);b?a(this).removeClass("i-disabled"):a(this).addClass("i-disabled")}):"list"===f.type&&g.find(".b-catalog-element__"+e+" .b-catalog-element__sizes-item").each(function(){for(var b=!1,d=0;d<c[e].length&&(a(this).text()===""+c[e][d]&&(b=!0),!b);d++);b?a(this).removeClass("i-disabled"):a(this).addClass("i-disabled")})})}function f(b,c){g.attr({"data-id":b.data("id")+""}),v.forEach(function(c){"color"===c.type?g.find(".b-catalog-element__"+c.code+" .b-catalog-element__colors-item").each(function(){-1!==a(this).css("backgroundImage").search(b.data(c.type+"-"+c.code))?a(this).addClass("i-active").removeClass("i-disabled"):a(this).removeClass("i-active")}):"list"===c.type&&g.find(".b-catalog-element__"+c.code+" .b-catalog-element__sizes-item").each(function(){a(this).text()===""+b.data(c.type+"-"+c.code)?a(this).addClass("i-active").removeClass("i-disabled"):a(this).removeClass("i-active")})});var d="",e=[],f="";b.data("photo")&&(e=b.data("photo").split(";")),g.find(".b-catalog-element__button .btn").length&&(f=g.find(".b-catalog-element__button .btn").attr("href")),m.length&&e[0]&&e[1]?u.css("opacity")>0?(m.css({backgroundImage:"url('"+e[0]+"')"}),n.css({backgroundImage:"url("+e[1]+")"})):(m.attr({"data-original":e[0]}),n.attr({"data-original":e[1]})):i.length&&(e.forEach(function(a,b,c){d+='<div><a href="'+f+'" class="b-catalog-element__fotorama-img" style="background-image: url(\''+a+"');\" ></a></div>"}),j.length&&(j.data("fotorama")&&j.data("fotorama").destroy(),j.empty().html(d),!c&&j.find(".b-catalog-element__fotorama-img").length>1&&j.fotorama(),u.css("opacity")>0&&j.data("fotorama")&&j.data("fotorama").startAutoplay(3e3))),p.length&&o.length&&(0!==b.data("num")?(o.show().find("span").text(b.data("num")),p.hide()):(o.hide(),p.show())),q.length&&(b.data("discount-percent")?q.show().text(b.data("discount-percent")):q.hide()),g.find(".b-catalog-element__props div").each(function(){-1!==String(a(this).attr("class")).search("catalogElementProperty")&&a(this).addClass("hidden")});for(var h in b.data())-1!==h.search("property")&&g.find(".catalogElementP"+h.substring(1)).find("span").text(b.data(h)).parent().removeClass("hidden");t.length&&b.data("price")&&(b.data("old-price")?t.addClass("i-discount").empty().html("<span>"+b.data("price")+"</span><s>"+b.data("old-price")+"</s>"):t.removeClass("i-discount").empty().text(b.data("price"))),r.length&&s.length&&("Y"===b.data("available")?(r.show(),s.addClass("hidden")):r.hide(),"Y"===b.data("subscribe")&&"Y"!==b.data("available")?(r.hide(),s.removeClass("hidden")):"Y"!==b.data("subscribe")&&"Y"!==b.data("available")&&(r.hide(),s.addClass("hidden")))}var g=a(this),h=g.find(".b-catalog-element__propList-block"),i=g.find(".b-catalog-element__gallery"),j=g.find(".b-catalog-element__gallery .b-catalog-element__fotorama"),k=g.find(".b-catalog-element__data div"),l=k.eq(0),m=g.find(".b-catalog-element__img"),n=g.find(".b-catalog-element__img-hover"),o=(g.find(".b-catalog-element__art"),g.find(".b-catalog-element__code"),g.find(".b-catalog-element__num .i-1")),p=g.find(".b-catalog-element__num .i-0"),q=g.find(".b-icon-discount"),r=g.find(".b-catalog-element__button"),s=g.find(".b-catalog-element__subscribe"),t=g.find(".b-catalog-element__price"),u=g.find(".b-catalog-element__bottom"),v=g.find(".b-catalog-element__data").data("prop-list"),w={};"string"==typeof v&&(v=v.replace(/&quot;/g,'"'),v=JSON.parse(v)),g.find(".b-catalog-element__data[ data-actual-item ]").length&&(l=g.find(".b-catalog-element__data div[ data-id="+g.find(".b-catalog-element__data").data("actual-item")+" ]")),h.delegate(".b-catalog-element__colors-item, .b-catalog-element__sizes-item","click",function(){var c=a(this);if(!c.hasClass("i-active")){var d,h=c.parent().data("prop"),i=c.text()||c.css("backgroundImage"),j=(c.siblings(".i-active"),l.attr("data-id")),k="",m=[];for(var n in w[j])h===w[j][n][1]&&(k=n);if(m=String(k).split(","),c.hasClass("i-disabled")){var o=[],p=0,q={};for(var r in w)for(var s in w[r])b(c.attr("class"),i,w[r][s][3])&&h===w[r][s][1]&&(q={},q[r]=w[r],o.push(q));for(var t=0;t<o.length;t++)for(var u in o[t]){var v=0;for(var x in o[t][u])if(o[t][u][x][1]===h)for(var y=String(x).split(","),z=0;z<m.length;z++)y.includes(m[z])&&v++;(v>p||0===p)&&(p=v,d=u)}}else for(var A in w)for(var B in w[A])B===k&&b(c.attr("class"),i,w[A][B][3])&&(d=A);l=g.find(".b-catalog-element__data div[data-id="+d+"]"),f(l),e()}});var x,y;g.hover(function(){j.length&&!j.data("fotorama")&&j.find(".b-catalog-element__fotorama-img").length&&j.fotorama(),u.show(),clearTimeout(x),clearTimeout(y),x=setTimeout(function(){g.addClass("i-hover")},0),i.length&&j.length&&j.data("fotorama")&&j.data("fotorama").startAutoplay(3e3)},function(){a(this).removeClass("i-hover"),clearTimeout(x),clearTimeout(y),y=setTimeout(function(){u.hide()},500),i.length&&j.length&&j.data("fotorama")&&j.data("fotorama").stopAutoplay()}),k.length&&(c(),d())}),a(".b-catalog-element__img, .b-catalog-element__img-hover").lazyload()})}(jQuery);