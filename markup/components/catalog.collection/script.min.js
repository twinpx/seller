!function(a){"use strict";a(function(){function b(){window.matchMedia("( min-width: 768px )").matches?a(".b-catalog-element").each(function(){var b=a(this),c=b.find(".b-catalog-element__title");String(c.text()).length>40&&c.text(a.trim(String(c.text()).substring(0,39))+"...")}):a(".b-catalog-element").each(function(){var b=a(this),c=b.find(".b-catalog-element__title");String(c.text()).length>107&&c.text(a.trim(String(c.attr("title")).substring(0,107))+"...")})}-1!==String(window.location.search).search("sort=")&&setTimeout(function(){a.scrollTo(a(".bj-sorting:eq(0)").offset().top-30,500)},1500),-1!==String(window.location.search).search("PAGEN_2=")&&setTimeout(function(){a.scrollTo(a(".b-catalog-collection:eq(0)").offset().top-30,500)},1500),b(),a("#buyModal").on("show.bs.modal",function(b){var c,d=a(b.relatedTarget),e=d.closest(".b-catalog-element"),f=e.find(".b-catalog-element__title").text(),g=e.find(".b-catalog-element__sizes-item.i-active").text(),h=e.find(".b-catalog-element__colors-item.i-active").css("backgroundImage"),i=e.find(".b-catalog-element__colors-item.i-active").attr("class");c=e.find(".b-catalog-element__img").length?e.find(".b-catalog-element__img").css("backgroundImage"):e.find(".fotorama__active .b-catalog-element__fotorama-img").css("backgroundImage"),a("#buyModal .b-buy-modal-img").html("<div style='background: "+c+' no-repeat center; background-size: cover; padding-top: 130%;\' alt="">'),a("#buyModal .b-buy-modal-text").html("<h2>"+f+'</h2><p><span class="'+i+"\" style='background-image: "+h+"; margin-bottom: 20px;'></span><br>"+g+"</p>")}),a("#buyModal .btn-reset").click(function(b){b.preventDefault(),a("#buyModal .modal-header .close").click()}),a("#subscribeModal").on("show.bs.modal",function(b){var c=a(b.relatedTarget);a.ajax({url:c.data("ajax-url"),type:"GET",dataType:"html",data:"id="+c.closest(".b-catalog-element").attr("data-id"),success:function(b){b&&(a("#subscribeModal form").remove(),a("#subscribeModal .modal-header").after(b))},error:function(a,b,c){console.log(a),console.log(b),console.log(c)}})}),a("#subscribeModal").delegate("form","submit",function(b){b.preventDefault();var c=a(this),d=a("#subscribeModal .modal-body");a.ajax({url:c.attr("action"),type:c.attr("method"),dataType:"json",data:c.serialize(),success:function(b){b&&b.MESSAGE&&(d.height(d.height()),d.empty().append('<p class="text-center">'+b.MESSAGE+"</p>"),d.height(d.find("p").height()),a("#subscribeModal .modal-footer .btn").hide(),a("#subscribeModal .modal-footer .i-gray").show())},error:function(a,b,c){console.log(a),console.log(b),console.log(c)}})}),a(".b-catalog-element__button .btn").click(function(b){b.preventDefault(),a(".b-catalog-element__button .btn").trigger("add.ecommerce");var c=a(this);a.ajax({url:c.data("ajax-url"),type:"GET",dataType:"json",data:"id="+c.closest(".b-catalog-element").attr("data-id"),success:function(b){b&&"Y"===b.STATUS&&a("#bx_cart_num").text(b.cart)},error:function(){}})}),a(".b-catalog-element").each(function(){function b(){h.empty();var b=[];l.each(function(){var c=!0,d=a(this);b.forEach(function(a,b,e){if(!d.data("color-color_ref")||a===d.data("color-color_ref"))return void(c=!1)}),c&&a(this).data("color-color_ref")&&b.push(a(this).data("color-color_ref"))}),b.length?b.forEach(function(b,c,d){var e=a('<span class="b-catalog-element__colors-item" style="background-image: url( \''+b+"' )\"><span></span></span>"),f=document.createElement("img");f.setAttribute("src",b),f.addEventListener("load",function(){new Vibrant(f).isWhiteImage&&e.addClass("i-white")}),h.append(e)}):(h.next("hr").remove(),h.remove()),i.empty();var c=[];l.each(function(){var b=!0,d=a(this);c.forEach(function(a,c,e){if(!d.data("list-sizes_shoes")||a===d.data("list-sizes_shoes"))return void(b=!1)}),b&&a(this).data("list-sizes_shoes")&&c.push(a(this).data("list-sizes_shoes"))}),c.length?c.forEach(function(a,b,c){i.append('<span class="b-catalog-element__sizes-item"><span>'+a+"</span></span>")}):(i.prev("hr:not(.i-line)").remove(),i.remove())}function c(){if(1===l.length)return void d(l);var b,c=!1;g.find(".b-catalog-element__sizes-item:eq(0)").length&&(b=window.Cookies&&Cookies.get("size")?Cookies.get("size"):g.find(".b-catalog-element__sizes-item:eq(0)").text(),g.find(".b-catalog-element__sizes-item").each(function(){var d=a(this);c||d.text()===b&&(c=!0)}),c||(b=g.find(".b-catalog-element__sizes-item:eq(0)").text()));var h=!1;g.find(".b-catalog-element__colors-item").length?g.find(".b-catalog-element__sizes-item").length?l.each(function(){var c=a(this);g.find(".b-catalog-element__colors-item").each(function(){-1!==a(this).css("backgroundImage").search(c.data("color-color_ref"))&&c.data("list-sizes_shoes")+""==b+""&&(h||(d(c,"onPageLoad"),h=!0))})}):l.each(function(){var b=a(this);g.find(".b-catalog-element__colors-item").each(function(){-1!==a(this).css("backgroundImage").search(b.data("color-color_ref"))&&(h||(d(b,"onPageLoad"),h=!0))})}):g.find(".b-catalog-element__sizes-item").length?l.each(function(){var c=a(this);c.data("list-sizes_shoes")+""==b+""&&(h||(d(c,"onPageLoad"),h=!0))}):h||(d(l.eq(0),"onPageLoad"),h=!0),g.find(".b-catalog-element__sizes-item.i-active").length&&g.find(".b-catalog-element__colors-item.i-active").length&&(e(g.find(".b-catalog-element__sizes-item.i-active")),f(g.find(".b-catalog-element__colors-item.i-active")))}function d(b,c){g.attr({"data-id":b.data("id")+""}),g.find(".b-catalog-element__colors-item").each(function(){-1!==a(this).css("backgroundImage").search(b.data("color-color_ref"))&&a(this).addClass("i-active")}),g.find(".b-catalog-element__sizes-item").each(function(){a(this).text()===b.data("list-sizes_shoes")+""&&a(this).addClass("i-active")});var d="",e=[],f="";b.data("photo")&&(e=b.data("photo").split(";")),g.find(".b-catalog-element__button .btn").length&&(f=g.find(".b-catalog-element__button .btn").attr("href")),m.length&&e[0]&&e[1]?u.css("opacity")>0?(m.css({backgroundImage:"url('"+e[0]+"')"}),n.css({backgroundImage:"url("+e[1]+")"})):(m.attr({"data-original":e[0]}),n.attr({"data-original":e[1]})):j.length&&(e.forEach(function(a,b,c){d+='<div><a href="'+f+'" class="b-catalog-element__fotorama-img" style="background-image: url(\''+a+"');\" ></a></div>"}),k.length&&(k.data("fotorama")&&k.data("fotorama").destroy(),k.empty().html(d),!c&&k.find(".b-catalog-element__fotorama-img").length>1&&k.fotorama(),u.css("opacity")>0&&k.data("fotorama")&&k.data("fotorama").startAutoplay(3e3))),p.length&&o.length&&(0!==b.data("num")?(o.show().find("span").text(b.data("num")),p.hide()):(o.hide(),p.show())),q.length&&(b.data("discount-percent")?q.show().text(b.data("discount-percent")):q.hide()),g.find(".b-catalog-element__props div").each(function(){-1!==String(a(this).attr("class")).search("catalogElementProperty")&&a(this).addClass("hidden")});for(var h in b.data())-1!==h.search("property")&&g.find(".catalogElementP"+h.substring(1)).find("span").text(b.data(h)).parent().removeClass("hidden");t.length&&b.data("price")&&(b.data("old-price")?t.addClass("i-discount").empty().html("<span>"+b.data("price")+"</span><s>"+b.data("old-price")+"</s>"):t.removeClass("i-discount").empty().text(b.data("price"))),r.length&&s.length&&("Y"===b.data("available")?(r.show(),s.addClass("hidden")):r.hide(),"Y"===b.data("subscribe")&&"Y"!==b.data("available")?(r.hide(),s.removeClass("hidden")):"Y"!==b.data("subscribe")&&"Y"!==b.data("available")&&(r.hide(),s.addClass("hidden")))}function e(b){var c=a(b),e=c.text(),f=[];l.each(function(){var b=a(this);b.data("list-sizes_shoes")+""===e&&f.push({color:b.data("color-color_ref"),available:b.data("available"),subscribe:b.data("subscribe")})}),g.find(".b-catalog-element__colors-item").each(function(){var b=!1,c=a(this);f.forEach(function(a,d,e){-1===c.css("backgroundImage").search(a.color)||"Y"!==a.available&&"Y"!==a.subscribe||(b=!0)}),b?c.removeClass("i-disabled"):c.addClass("i-disabled")}),g.find(".b-catalog-element__colors-item.i-active").length&&g.find(".b-catalog-element__colors-item.i-active").hasClass("i-disabled")&&(g.find(".b-catalog-element__colors-item.i-active").removeClass("i-active"),g.find(".b-catalog-element__colors-item:not( .i-disabled ):eq(0)").length&&g.find(".b-catalog-element__colors-item:not( .i-disabled ):eq(0)").addClass("i-active")),l.each(function(){g.find(".b-catalog-element__colors-item.i-active").length&&g.find(".b-catalog-element__sizes-item.i-active").length?-1!==g.find(".b-catalog-element__colors-item.i-active").css("backgroundImage").search(a(this).data("color-color_ref"))&&a(this).data("list-sizes_shoes")+""===g.find(".b-catalog-element__sizes-item.i-active").text()&&d(a(this)):g.find(".b-catalog-element__colors-item.i-active").length?-1!==g.find(".b-catalog-element__colors-item.i-active").css("backgroundImage").search(a(this).data("color-color_ref"))&&d(a(this)):g.find(".b-catalog-element__sizes-item.i-active").length&&a(this).data("list-sizes_shoes")+""===g.find(".b-catalog-element__sizes-item.i-active").text()&&d(a(this))})}function f(b){var c=a(b),e=c.css("backgroundImage"),f=[];l.each(function(){var b=a(this);-1!==e.search(b.data("color-color_ref"))&&f.push({size:b.data("list-sizes_shoes"),available:b.data("available"),subscribe:b.data("subscribe")})}),g.find(".b-catalog-element__sizes-item").each(function(){var b=!1,c=!1,d=a(this);f.forEach(function(a,e,f){d.text()===a.size+""&&("Y"===a.available?b=!0:"Y"===a.subscribe&&(c=!0))}),b?d.removeClass("i-disabled"):d.addClass("i-disabled"),c?d.addClass("i-subscribe").removeClass("i-disabled"):d.removeClass("i-subscribe")}),g.find(".b-catalog-element__sizes-item.i-active").length&&g.find(".b-catalog-element__sizes-item.i-active").hasClass("i-disabled")&&(g.find(".b-catalog-element__sizes-item.i-active").removeClass("i-active"),g.find(".b-catalog-element__sizes-item:not( .i-disabled ):eq(0)").length&&g.find(".b-catalog-element__sizes-item:not( .i-disabled ):eq(0)").addClass("i-active")),l.each(function(){g.find(".b-catalog-element__colors-item.i-active").length&&-1!==String(g.find(".b-catalog-element__colors-item.i-active").css("backgroundImage")).search(a(this).data("color-color_ref"))&&g.find(".b-catalog-element__sizes-item.i-active").length&&a(this).data("list-sizes_shoes")+""===g.find(".b-catalog-element__sizes-item.i-active").text()&&d(a(this))})}var g=a(this),h=g.find(".b-catalog-element__colors-block"),i=g.find(".b-catalog-element__sizes-block"),j=g.find(".b-catalog-element__gallery"),k=g.find(".b-catalog-element__gallery .b-catalog-element__fotorama"),l=g.find(".b-catalog-element__data div"),m=g.find(".b-catalog-element__img"),n=g.find(".b-catalog-element__img-hover"),o=(g.find(".b-catalog-element__art"),g.find(".b-catalog-element__code"),g.find(".b-catalog-element__num .i-1")),p=g.find(".b-catalog-element__num .i-0"),q=g.find(".b-icon-discount"),r=g.find(".b-catalog-element__button"),s=g.find(".b-catalog-element__subscribe"),t=g.find(".b-catalog-element__price"),u=g.find(".b-catalog-element__bottom");h.delegate(".b-catalog-element__colors-item","click",function(){g.find(".b-catalog-element__colors-item").removeClass("i-active"),a(this).addClass("i-active"),g.find(".b-catalog-element__sizes-item").length?(f(this),e(g.find(".b-catalog-element__sizes-item.i-active"))):l.each(function(){g.find(".b-catalog-element__colors-item.i-active").length&&-1!==g.find(".b-catalog-element__colors-item.i-active").css("backgroundImage").search(a(this).data("color-color_ref"))&&d(a(this))})}),i.delegate(".b-catalog-element__sizes-item","click",function(){var b=a(this);g.find(".b-catalog-element__sizes-item").removeClass("i-active"),b.addClass("i-active"),window.Cookies&&Cookies.set("size",b.text(),{expires:365,path:window.location.origin}),g.find(".b-catalog-element__colors-item").length?(e(this),f(g.find(".b-catalog-element__colors-item.i-active"))):l.each(function(){g.find(".b-catalog-element__sizes-item.i-active").length&&a(this).data("list-sizes_shoes")+""===g.find(".b-catalog-element__sizes-item.i-active").text()&&d(a(this))})});var v,w;g.hover(function(){k.length&&!k.data("fotorama")&&k.find(".b-catalog-element__fotorama-img").length&&k.fotorama(),u.show(),clearTimeout(v),clearTimeout(w),v=setTimeout(function(){g.addClass("i-hover")},0),j.length&&k.length&&k.data("fotorama")&&k.data("fotorama").startAutoplay(3e3)},function(){a(this).removeClass("i-hover"),clearTimeout(v),clearTimeout(w),w=setTimeout(function(){u.hide()},500),j.length&&k.length&&k.data("fotorama")&&k.data("fotorama").stopAutoplay()}),l.length&&(b(),c())}),a(".b-catalog-element__img, .b-catalog-element__img-hover").lazyload()})}(jQuery);