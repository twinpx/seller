!function(a){"use strict";a(function(){window.ymaps&&ymaps.ready(function(){function b(){e=new ymaps.Map("yMapShops",{center:[55.751574,37.573856],zoom:12,controls:["geolocationControl","zoomControl"]},{yandexMapDisablePoiInteractivity:!0,searchControlProvider:"yandex#search"}),e.behaviors.disable("scrollZoom"),e.events.add("click",function(a){e.balloon.close()}),g={build:function(){this.constructor.superclass.build.call(this),this._$element=a(".b-shop-balloon",this.getParentElement()),this.applyElementOffset(),this._$element.find(".b-shop-balloon__close").on("click",a.proxy(this.onCloseClick,this))},clear:function(){this._$element.find(".b-shop-balloon__close").off("click"),this.constructor.superclass.clear.call(this)},applyElementOffset:function(){this._$element.css({left:-this._$element[0].offsetWidth/2,top:-this._$element[0].offsetHeight})},onCloseClick:function(a){a.preventDefault(),this.events.fire("userclose")},_isElement:function(a){return a&&a[0]&&a.find(".arrow")[0]}};var b="islands#blackClusterIcons";window.yMapPlacemarksIcons&&(b="islands#"+yMapPlacemarksIcons),f=new ymaps.Clusterer({preset:b,groupByCoordinates:!1}),h=ymaps.templateLayoutFactory.createClass('<a href="$[properties.href]" class="b-shop-balloon"><span class="b-shop-balloon__close"></span><span class="b-shop-balloon__img" style="background-image: url(\'$[properties.img]\');"></span><span class="b-shop-balloon__heading">$[properties.heading]</span></a>',g),a(".b-map__nav-item.i-active").each(function(){c(a(this).data("tab"))}),e.geoObjects.add(f),e.setBounds(f.getBounds(),{checkZoomRange:!0,duration:500})}function c(a){if(a)try{window.yMapPlacemarks[a].forEach(function(a){var b=new ymaps.Placemark(a.coords,{img:a.img,heading:a.heading,href:a.href,balloonContent:"цвет <strong>воды пляжа бонди</strong>"},{iconLayout:"default#image",iconImageHref:a.icon,iconImageSize:[32,32],iconImageOffset:[-16,-16],balloonShadow:!1,balloonContentLayout:h});f.add(b)})}catch(a){}}var d=a("#yMapShops");a.ajax({url:d.data("ajax-url"),type:d.data("ajax-method"),dataType:"json",success:function(a){a&&"object"==typeof a&&"Y"===a.STATUS&&a.DATA&&(window.yMapPlacemarks=a.DATA,b())},error:function(a,b,c){window.console&&(console.log(a),console.log(b),console.log(c))}});var e,f,g,h;a(".b-map__nav-item, .b-map .dropdown-menu a").click(function(b){var d=a(this),g=a(this).closest(".b-map");f.removeAll(),d.hasClass("b-map__nav-item")?(g.data("singletab")&&g.find(".b-map__nav-item").removeClass("i-active"),d.toggleClass("i-active"),a(".b-map__nav-item.i-active").each(function(){c(a(this).data("tab"))})):d.is("a")&&(b.preventDefault(),b.stopPropagation(),"all"===d.data("tab")?g.find(".dropdown-menu a").each(function(){c(a(this).data("tab"))}):c(d.data("tab"))),e.setBounds(f.getBounds(),{checkZoomRange:!0,duration:500})})})})}(jQuery);