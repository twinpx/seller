!function(a){"use strict";a(function(){window.ymaps&&ymaps.ready(function(){function b(){e=new ymaps.Map("yMapShops",{center:[55.751574,37.573856],zoom:12,controls:["geolocationControl","zoomControl"]},{yandexMapDisablePoiInteractivity:!0,searchControlProvider:"yandex#search"}),e.behaviors.disable("scrollZoom"),e.events.add("click",function(a){e.balloon.close()}),g=ymaps.templateLayoutFactory.createClass('<a href="$[properties.href]" class="b-shop-balloon"><span class="b-shop-balloon__close"></span><span class="b-shop-balloon__img" style="background-image: url(\'$[properties.img]\');"></span><span class="b-shop-balloon__heading">$[properties.heading]</span></a>',{build:function(){this.constructor.superclass.build.call(this),this._$element=a("a.b-shop-balloon",this.getParentElement()),this.applyElementOffset(),this._$element.find(".b-shop-balloon__close").on("click",a.proxy(this.onCloseClick,this))},clear:function(){this._$element.find(".b-shop-balloon__close").off("click"),this.constructor.superclass.clear.call(this)},onSublayoutSizeChange:function(){g.superclass.onSublayoutSizeChange.apply(this,arguments),this._isElement(this._$element)&&(this.applyElementOffset(),this.events.fire("shapechange"))},applyElementOffset:function(){this._$element.css({left:-this._$element[0].offsetWidth/2,top:-this._$element[0].offsetHeight})},onCloseClick:function(a){a.preventDefault(),a.stopPropagation(),this.events.fire("userclose")},getShape:function(){if(!this._isElement(this._$element))return g.superclass.getShape.call(this);var a=this._$element.position();return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[a.left,a.top],[a.left+this._$element[0].offsetWidth,a.top+this._$element[0].offsetHeight]]))},_isElement:function(a){return a&&a[0]}});var b="islands#blackClusterIcons";window.yMapPlacemarksIcons&&(b="islands#"+yMapPlacemarksIcons),f=new ymaps.Clusterer({preset:b,groupByCoordinates:!1}),c(),e.geoObjects.add(f),e.setBounds(f.getBounds(),{checkZoomRange:!0,duration:500})}function c(){try{window.yMapPlacemarks.forEach(function(a){var b=new ymaps.Placemark(a.coords,{img:a.img,heading:a.heading,href:a.href},{iconLayout:"default#image",iconImageHref:a.icon,iconImageSize:[32,32],iconImageOffset:[-16,-16],balloonShadow:!1,balloonLayout:g,balloonPanelMaxMapArea:0});f.add(b)})}catch(a){console.log(a)}}var d=a("#yMapShops");a.ajax({url:d.data("ajax-url"),type:d.data("ajax-method"),dataType:"json",success:function(a){a&&"object"==typeof a&&"Y"===a.STATUS&&a.DATA&&(window.yMapPlacemarks=a.DATA,b())},error:function(a,b,c){window.console&&(console.log(a),console.log(b),console.log(c))}});var e,f,g})})}(jQuery);